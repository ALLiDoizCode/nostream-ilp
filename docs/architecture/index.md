# Nostr-ILP Relay Architecture Document

## Table of Contents

- [Nostr-ILP Relay Architecture Document](#table-of-contents)
  - [Introduction](./introduction.md)
    - [Starter Template or Existing Project](./introduction.md#starter-template-or-existing-project)
    - [Change Log](./introduction.md#change-log)
  - [High Level Architecture](./high-level-architecture.md)
    - [Technical Summary](./high-level-architecture.md#technical-summary)
    - [High Level Overview](./high-level-architecture.md#high-level-overview)
    - [High Level Project Diagram](./high-level-architecture.md#high-level-project-diagram)
    - [Architectural and Design Patterns](./high-level-architecture.md#architectural-and-design-patterns)
  - [Tech Stack](./tech-stack.md)
    - [Cloud Infrastructure](./tech-stack.md#cloud-infrastructure)
    - [Technology Stack Table](./tech-stack.md#technology-stack-table)
  - [Data Models](./data-models.md)
    - [NostrEvent](./data-models.md#nostrevent)
    - [PaymentClaim](./data-models.md#paymentclaim)
    - [PaymentChannel (Dassie Internal State)](./data-models.md#paymentchannel-dassie-internal-state)
    - [EconomicSnapshot](./data-models.md#economicsnapshot)
    - [ArweaveBackup](./data-models.md#arweavebackup)
    - [ArchivedEvent (Stub Record)](./data-models.md#archivedevent-stub-record)
    - [CosmWasmPaymentChannel (Smart Contract State)](./data-models.md#cosmwasmpaymentchannel-smart-contract-state)
  - [Source Tree Structure](./source-tree-structure.md)
    - [Nostream-ILP Repository Layout](./source-tree-structure.md#nostream-ilp-repository-layout)
    - [Dassie-Relay Repository Layout (Fork or Upstream)](./source-tree-structure.md#dassie-relay-repository-layout-fork-or-upstream)
    - [CosmWasm Payment Channels Repository](./source-tree-structure.md#cosmwasm-payment-channels-repository)
    - [Key Files and Their Purposes](./source-tree-structure.md#key-files-and-their-purposes)
  - [Backend System Design](./backend-system-design.md)
    - [System Components Overview](./backend-system-design.md#system-components-overview)
    - [Component Diagram](./backend-system-design.md#component-diagram)
    - [Component Specifications](./backend-system-design.md#component-specifications)
      - [1. WebSocket Server (Nostream Entry Point)](./backend-system-design.md#1-websocket-server-nostream-entry-point)
      - [2. Event Handler (Core Nostr Logic)](./backend-system-design.md#2-event-handler-core-nostr-logic)
      - [3. Payment Verifier (Dassie Integration)](./backend-system-design.md#3-payment-verifier-dassie-integration)
      - [4. Dassie RPC Client (tRPC Integration)](./backend-system-design.md#4-dassie-rpc-client-trpc-integration)
      - [5. Economic Monitor (Financial Automation)](./backend-system-design.md#5-economic-monitor-financial-automation)
      - [6. Arweave Integration](./backend-system-design.md#6-arweave-integration)
  - [API Specifications](./api-specifications.md)
    - [Nostr Protocol APIs (WebSocket)](./api-specifications.md#nostr-protocol-apis-websocket)
      - [Client → Relay Messages](./api-specifications.md#client-relay-messages)
      - [Relay → Client Messages](./api-specifications.md#relay-client-messages)
    - [Dashboard REST API](./api-specifications.md#dashboard-rest-api)
      - [GET /dashboard/metrics](./api-specifications.md#get-dashboardmetrics)
      - [GET /dashboard/payments](./api-specifications.md#get-dashboardpayments)
      - [GET /dashboard/health](./api-specifications.md#get-dashboardhealth)
      - [GET /dashboard/channels](./api-specifications.md#get-dashboardchannels)
      - [POST /dashboard/config](./api-specifications.md#post-dashboardconfig)
    - [Dassie RPC API (tRPC)](./api-specifications.md#dassie-rpc-api-trpc)
      - [payment.getChannelState](./api-specifications.md#paymentgetchannelstate)
      - [payment.verifyPaymentClaim](./api-specifications.md#paymentverifypaymentclaim)
      - [payment.recordClaim](./api-specifications.md#paymentrecordclaim)
      - [payment.convertToAKT](./api-specifications.md#paymentconverttoakt)
      - [ledger.getBalance](./api-specifications.md#ledgergetbalance)
      - [ledger.subscribeToAccount](./api-specifications.md#ledgersubscribetoaccount)
      - [settlement.openChannel](./api-specifications.md#settlementopenchannel)
      - [settlement.closeChannel](./api-specifications.md#settlementclosechannel)
    - [Arweave Upload API (Internal)](./api-specifications.md#arweave-upload-api-internal)
      - [arweaveService.upload(content, metadata)](./api-specifications.md#arweaveserviceuploadcontent-metadata)
      - [arweaveService.uploadBackup(compressedData, manifest)](./api-specifications.md#arweaveserviceuploadbackupcompresseddata-manifest)
      - [arweaveService.retrieve(txId)](./api-specifications.md#arweaveserviceretrievetxid)
  - [Security Architecture](./security-architecture.md)
    - [Threat Model](./security-architecture.md#threat-model)
    - [Security Layers](./security-architecture.md#security-layers)
    - [Authentication & Authorization](./security-architecture.md#authentication-authorization)
      - [Nostr Client Authentication (NIP-42)](./security-architecture.md#nostr-client-authentication-nip-42)
      - [Dashboard Authentication (HTTP Basic Auth)](./security-architecture.md#dashboard-authentication-http-basic-auth)
      - [Dassie RPC Authentication](./security-architecture.md#dassie-rpc-authentication)
    - [Payment Security](./security-architecture.md#payment-security)
      - [Preventing Replay Attacks](./security-architecture.md#preventing-replay-attacks)
      - [Signature Verification](./security-architecture.md#signature-verification)
      - [Double-Spend Prevention](./security-architecture.md#double-spend-prevention)
    - [Data Security](./security-architecture.md#data-security)
      - [SQL Injection Protection](./security-architecture.md#sql-injection-protection)
      - [XSS Protection (Dashboard)](./security-architecture.md#xss-protection-dashboard)
      - [Secret Management](./security-architecture.md#secret-management)
    - [Network Security](./security-architecture.md#network-security)
      - [Container Network Isolation](./security-architecture.md#container-network-isolation)
      - [TLS/SSL Configuration](./security-architecture.md#tlsssl-configuration)
    - [Rate Limiting & DoS Protection](./security-architecture.md#rate-limiting-dos-protection)
      - [Per-IP Rate Limits](./security-architecture.md#per-ip-rate-limits)
      - [Per-Pubkey Rate Limits](./security-architecture.md#per-pubkey-rate-limits)
      - [Subscription Limits](./security-architecture.md#subscription-limits)
    - [Security Monitoring](./security-architecture.md#security-monitoring)
      - [Suspicious Activity Alerts](./security-architecture.md#suspicious-activity-alerts)
      - [Audit Logging](./security-architecture.md#audit-logging)
  - [Deployment Architecture](./deployment-architecture.md)
    - [Akash Network Deployment](./deployment-architecture.md#akash-network-deployment)
      - [Akash SDL (Stack Definition Language)](./deployment-architecture.md#akash-sdl-stack-definition-language)
      - [Deployment Steps](./deployment-architecture.md#deployment-steps)
    - [Docker Containerization](./deployment-architecture.md#docker-containerization)
      - [Nostream Dockerfile](./deployment-architecture.md#nostream-dockerfile)
      - [Dassie Dockerfile](./deployment-architecture.md#dassie-dockerfile)
    - [CI/CD Pipeline (GitHub Actions)](./deployment-architecture.md#cicd-pipeline-github-actions)
    - [Local Development Environment](./deployment-architecture.md#local-development-environment)
    - [Database Migrations](./deployment-architecture.md#database-migrations)
    - [Environment-Specific Configuration](./deployment-architecture.md#environment-specific-configuration)
  - [Monitoring & Observability](./monitoring-observability.md)
    - [Logging Strategy](./monitoring-observability.md#logging-strategy)
    - [Metrics Collection](./monitoring-observability.md#metrics-collection)
    - [Alerting Rules](./monitoring-observability.md#alerting-rules)
    - [Dashboard Visualization](./monitoring-observability.md#dashboard-visualization)
    - [Distributed Tracing](./monitoring-observability.md#distributed-tracing)
  - [Error Handling & Resilience](./error-handling-resilience.md)
    - [Error Classification](./error-handling-resilience.md#error-classification)
    - [Retry Strategies](./error-handling-resilience.md#retry-strategies)
    - [Circuit Breaker Pattern](./error-handling-resilience.md#circuit-breaker-pattern)
    - [Graceful Degradation](./error-handling-resilience.md#graceful-degradation)
    - [Health Checks](./error-handling-resilience.md#health-checks)
  - [Performance & Scalability](./performance-scalability.md)
    - [Performance Targets](./performance-scalability.md#performance-targets)
    - [Database Optimization](./performance-scalability.md#database-optimization)
    - [Caching Strategy](./performance-scalability.md#caching-strategy)
    - [WebSocket Optimization](./performance-scalability.md#websocket-optimization)
    - [Horizontal Scaling (Future)](./performance-scalability.md#horizontal-scaling-future)
