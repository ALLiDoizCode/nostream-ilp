# Nostream-ILP Environment Configuration
# Copy this file to .env and customize for your environment

# ============================================================================
# REQUIRED - Must be set before deployment
# ============================================================================

# Nostream secret key for signing (generate with: openssl rand -hex 32)
SECRET=your-secret-key-here

# ============================================================================
# OPTIONAL - Docker Configuration (Epic 8)
# ============================================================================

# Port for Nostream relay (default: 8008)
RELAY_PORT=8008

# Database Configuration (defaults work for local testing)
DB_PASSWORD=nostr_ts_relay

# Redis Configuration (defaults work for local testing)
REDIS_PASSWORD=nostr_ts_relay

# BTP-NIPs Configuration (default: true)
BTP_NIPS_ENABLED=true

# ============================================================================
# OPTIONAL - Payment Processors
# ============================================================================

# ZEBEDEE_API_KEY=
# NODELESS_API_KEY=
# NODELESS_WEBHOOK_SECRET=
# OPENNODE_API_KEY=
# LNBITS_API_KEY=

# ============================================================================
# Dassie ILP Node Configuration (Story 1.2+)
# ============================================================================

# WebSocket URL for Dassie RPC endpoint
# Default: ws://localhost:7768/trpc (local development)
# Production: ws://dassie:7768/trpc (Docker Compose)
DASSIE_RPC_URL=ws://localhost:7768/trpc

# Dassie RPC Authentication (Story 2.12+)
# Generate with: openssl rand -hex 32 (minimum 32 characters)
# REQUIRED for Dassie RPC connection in production
DASSIE_RPC_TOKEN=your-token-here-min-32-chars

# Feature flag: Are custom payment.* endpoints available in Dassie?
# Set to 'true' only after Epic 2 Dassie fork is complete
# Default: false
DASSIE_PAYMENT_ENDPOINTS_AVAILABLE=false

# ============================================================================
# Health Check Configuration (Story 1.7)
# ============================================================================

# HTTP endpoint for Dassie liveness check
# Used as fallback if WebSocket connection state is ambiguous
# Default: http://localhost:5000 (local development)
# Production: http://dassie:5000 (Docker Compose)
DASSIE_HTTP_URL=http://localhost:5000

# Degraded mode queue size limit
# Maximum number of payment verifications to queue during Dassie outage
# If exceeded, oldest events will be dropped
# Default: 10000
DEGRADED_MODE_MAX_QUEUE_SIZE=10000

# Health check interval (milliseconds)
# How often to poll Dassie HTTP health endpoint (WebSocket state is real-time)
# Note: Not currently used - health checks are on-demand via /healthz endpoint
# Default: 30000 (30 seconds)
# HEALTH_CHECK_INTERVAL_MS=30000

# ============================================================================
# Dassie Settlement Modules (Story 2.12)
# ============================================================================

# Base L2 Settlement (optional)
SETTLEMENT_BASE_ENABLED=false
SETTLEMENT_BASE_RPC_URL=https://sepolia.base.org
SETTLEMENT_BASE_FACTORY_ADDRESS=0x...
# Private key for settlement transactions (NEVER commit to version control!)
SETTLEMENT_BASE_RELAY_PRIVATE_KEY=0x...

# Cronos Settlement (optional)
SETTLEMENT_CRONOS_ENABLED=false
SETTLEMENT_CRONOS_RPC_URL=https://evm-t3.cronos.org
SETTLEMENT_CRONOS_FACTORY_ADDRESS=0x9Ec2d217b14e67cAbF86F20F4E7462D6d7bc7684
# Private key for settlement transactions (NEVER commit to version control!)
SETTLEMENT_CRONOS_RELAY_PRIVATE_KEY=0x...

# ============================================================================
# Dashboard Authentication (Story 1.8)
# ============================================================================

# Dashboard username (optional, default: admin)
DASHBOARD_USERNAME=admin

# Dashboard password (REQUIRED for production)
# MUST be set to a strong password for dashboard access
# Leave empty only for local development (dashboard will be inaccessible)
DASHBOARD_PASSWORD=

# ============================================================================
# Nostream Relay Configuration
# ============================================================================

# See .nostr/settings.yaml for full relay configuration
# Environment variables can override YAML settings

# Relay name
# RELAY_NAME=nostream-ilp

# Relay description
# RELAY_DESCRIPTION=Nostr relay with ILP payment integration

# Public URL of this relay
# RELAY_PUBLIC_URL=wss://relay.example.com

# ============================================================================
# Database Configuration
# ============================================================================

# PostgreSQL connection
DB_HOST=localhost
DB_PORT=5432
DB_NAME=nostream
DB_USER=nostream
DB_PASSWORD=nostream

# Redis connection
REDIS_HOST=localhost
REDIS_PORT=6379
# REDIS_PASSWORD=

# ============================================================================
# Payment Configuration (Story 1.3+)
# ============================================================================

# Enable payment requirements for events
# PAYMENTS_ENABLED=false

# Currencies accepted for payment (comma-separated)
# ACCEPTED_CURRENCIES=BTC,BASE,AKT,XRP

# Minimum payment amounts (in smallest units: sats, wei, uakt, drops)
# MIN_PAYMENT_BTC_SATS=1000
# MIN_PAYMENT_BASE_WEI=100000000000000
# MIN_PAYMENT_AKT_UAKT=1000000
# MIN_PAYMENT_XRP_DROPS=1000000

# ============================================================================
# Pricing Configuration (Story 1.5)
# ============================================================================

# Default pricing for relay operations (in satoshis)
PRICING_STORE_EVENT=10           # Satoshis per event stored
PRICING_DELIVER_EVENT=1          # Satoshis per event delivered via REQ
PRICING_QUERY=5                  # Satoshis per REQ subscription

# Free Tier Configuration (Story 1.6)
# Number of free events per pubkey before payment required
# Set to 0 to disable free tier (all events require payment)
#
# Use cases:
#   - Trial period for new users
#   - Onboarding without requiring immediate payment setup
#   - Testing relay functionality before committing
#
# Example values:
#   100  = 100 free events (good for trial period, ~$1 value at 10 sats/event)
#   1000 = 1000 free events (generous trial, ~$10 value)
#   0    = no free tier (immediate payment required, recommended for production)
#
# Note: Whitelisted pubkeys have unlimited free events (see CLI tools)
# Note: Free tier is tracked per-pubkey in the database (persists across restarts)
PRICING_FREE_TIER_EVENTS=0

# Per-Kind Pricing Overrides (optional, comma-separated)
# Format: kind:amount (e.g., "1:10,30023:100,1063:500")
# Allows different pricing for specialized content types
# Examples:
#   - Kind 1 (short note): 10 sats
#   - Kind 30023 (long-form article): 100 sats
#   - Kind 1063 (file metadata): 500 sats
#   - Kind 71 (video): 1000 sats
PRICING_KIND_OVERRIDES=

# ============================================================================
# Logging Configuration
# ============================================================================

# Log level: trace, debug, info, warn, error, fatal
LOG_LEVEL=info

# Pretty print logs (development only)
LOG_PRETTY=true

# ============================================================================
# Development/Testing
# ============================================================================

# Node environment
NODE_ENV=development

# Enable debug output for specific modules (comma-separated)
# DEBUG=dassie-client,payment-processor

# Test mode (skip certain validations)
# TEST_MODE=false

# ============================================================================
# Base L2 Deployment Configuration
# ============================================================================

# Private key for deployer account (NEVER commit to version control)
# Generate with: npx hardhat account create
# Fund testnet wallet: https://www.coinbase.com/faucets/base-ethereum-goerli-faucet
# Format: 64 hex characters (without 0x prefix)
PRIVATE_KEY=

# BaseScan API key for contract verification
# Obtain from: https://basescan.org/myapikey (create free account)
# Required for: npx hardhat verify --network base-sepolia/base-mainnet
BASESCAN_API_KEY=

# Deployed contract addresses (populated after deployment)
# Base Sepolia Testnet
BASE_SEPOLIA_PAYMENT_CHANNEL_FACTORY=

# Base Mainnet (production)
BASE_MAINNET_PAYMENT_CHANNEL_FACTORY=

# ============================================================================
# Base Mainnet Deployment (Epic 4)
# ============================================================================

# Base RPC URL (L2 Optimistic Rollup)
# Default: https://mainnet.base.org (public endpoint)
# Alternative: Use Alchemy/Infura for production with rate limits
BASE_RPC_URL=https://mainnet.base.org

# BaseScan API key for contract verification
# Obtain from: https://basescan.org/myapikey (create free account)
# Required for: npx hardhat verify --network base
BASESCAN_API_KEY=

# Multi-Token Payment Channel Factory (Story 4.2)
# Deployed contract address on Base Mainnet (Chain ID: 8453)
# Supports: Native ETH (address(0)) and USDC (0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913)
BASE_MAINNET_FACTORY_ADDRESS=0xf7e968d6f3bdFC504A434288Ea3f243e033e846F

# Supported tokens on Base (configured in src/config/base-tokens.yaml)
# ETH: Native L2 currency (18 decimals)
# USDC: Circle USD Coin (6 decimals) - 0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913

# ============================================================================
# Akash Wallet Configuration (Epic 7 - Story 7.2)
# ============================================================================

# Enable Akash wallet for automated hosting payments
# Set to 'true' to enable Akash wallet functionality
# Default: false
AKASH_WALLET_ENABLED=false

# Akash wallet mnemonic (24-word phrase)
# SECURITY WARNING: Never commit this to version control!
# Use this to import an existing wallet OR leave empty to generate new wallet
# If both AKASH_WALLET_MNEMONIC and AKASH_WALLET_ENCRYPTED are empty,
# a new wallet will be generated on first run
AKASH_WALLET_MNEMONIC=

# Encrypted mnemonic from previous session (auto-populated)
# Do not manually edit this value
AKASH_WALLET_ENCRYPTED=

# Password to encrypt/decrypt wallet mnemonic
# REQUIRED when AKASH_WALLET_ENABLED=true
# Use a strong password (minimum 8 characters recommended)
AKASH_WALLET_PASSWORD=

# Akash RPC endpoint
# Default: https://rpc.akash.forbole.com:443 (mainnet)
# Testnet: https://rpc.testnet-02.aksh.pw:443
AKASH_RPC_ENDPOINT=https://rpc.akash.forbole.com:443

# Akash chain ID
# Mainnet: akashnet-2
# Testnet: testnet-02
AKASH_CHAIN_ID=akashnet-2

# Gas price for Akash transactions
# Format: <number>uakt (microAKT)
# Default: 0.025uakt
# Lower values = cheaper but slower confirmation
# Higher values = faster confirmation but more expensive
AKASH_GAS_PRICE=0.025uakt

# ============================================================================
# Akash Escrow Automation (Epic 7 - Story 7.4)
# ============================================================================

# Akash deployment lease ID
# Format: dseq/gseq/oseq (e.g., "12345/1/1")
# Required for escrow deposit automation
# Find this in your Akash deployment details
AKASH_LEASE_ID=

# Akash escrow account address
# This is the escrow account for your specific deployment
# Required for automatic deposits
# Format: akash1... (bech32 address)
AKASH_ESCROW_ADDRESS=

# Warning threshold (days)
# Emit warning when escrow balance falls below this many days
# Default: 7 days
AKASH_ESCROW_MIN_DAYS=7

# Auto-deposit target (days)
# Maintain this many days of hosting costs in escrow
# Default: 30 days (~1.5 AKT per day = 45 AKT target)
AKASH_ESCROW_TARGET_DAYS=30

# Daily hosting cost (AKT)
# Estimated cost per day for your deployment
# Default: 1.5 AKT/day (~$5/month at $2.50/AKT)
# Adjust based on your actual deployment costs
AKASH_ESCROW_DAILY_COST_AKT=1.5

# Minimum wallet balance (AKT)
# Never drain wallet below this amount
# Default: 10.0 AKT
# Ensures wallet retains some balance for gas fees
AKASH_ESCROW_WALLET_MIN_BALANCE=10.0

# Check interval (hours)
# How often to check escrow balance and deposit if needed
# Default: 24 hours (daily check)
# Note: Deposits also trigger automatically after AKT purchases
AKASH_ESCROW_CHECK_INTERVAL_HOURS=24
